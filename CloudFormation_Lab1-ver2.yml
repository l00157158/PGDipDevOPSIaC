Resources:

  # Define the security group
  SSHSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Enable SSH access
      SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: '22'
        ToPort: '22'
        CidrIp: 0.0.0.0/0  # allows SSH from any IP. 

  ATUec2:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: t2.micro
      ImageId: "ami-0ea0f26a6d50850c5"
      Tags:
      - Key: "Name"
        Value: "IAC-EC2-LAB-1"
      - Key: "Purpose"
        Value: "PGDIP-IAC"
      # Associate the security group with the EC2 instance
      SecurityGroups:
      - !Ref SSHSecurityGroup

Outputs:
  OutLab1Demo:
    Description: EC2 Instance
    Value: !Ref ATUec2
    Export:
      Name: ATUEC2DemoVal
  SecurityGroupID:
    Description: The ID of the security group
    Value: !Ref SSHSecurityGroup
